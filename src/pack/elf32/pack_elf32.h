//
// Created by youpaw on 11/1/23.
//

#ifndef PACK_ELF32_H
#define PACK_ELF32_H

#include "pack_exec.h"
#include <unistd.h>

#define PAYLOAD_ELF32 "\x50\x57\x56\x52\x51\x53\x55\x89\xE5\x83\xEC\x14\xC7\x45\xFC\xEF\xBE\xAD\xDE\xC7\x45\xF8\xEF\xBE\xAD\xDE\xC7\x45\xF4\xEF\xBE\xAD\xDE\xE8\x97\x00\x00\x00\x8B\x75\xF4\xF7\xDE\x01\xF7\x89\x7D\xF0\x89\xFE\x81\xE7\x00\xF0\xFF\xFF\xF7\xDF\x01\xFE\xF7\xDF\x03\x75\xFC\xB8\x7D\x00\x00\x00\x89\xFB\x89\xF1\xBA\x07\x00\x00\x00\xCD\x80\xE8\xC4\x00\x00\x00\x55\xB8\xC0\x00\x00\x00\x31\xDB\x8B\x4D\xFC\xBA\x03\x00\x00\x00\xBE\x22\x00\x00\x00\x31\xFF\x31\xED\xCD\x80\x5D\x89\x45\xEC\x55\xB8\xC0\x00\x00\x00\x31\xDB\xB9\x90\x80\x00\x01\xBA\x03\x00\x00\x00\xBE\x22\x00\x00\x00\x31\xFF\x31\xED\xCD\x80\x5D\x8B\x55\xEC\x8B\x75\xF8\x8B\x7D\xF0\x50\x52\x56\x57\xE8\x30\x01\x00\x00\xB9\x90\x80\x00\x01\x8B\x5C\x24\x0C\xB8\x5B\x00\x00\x00\xCD\x80\x83\xC4\x10\xE9\x04\x03\x00\x00\x55\x89\xE5\x83\xEC\x10\xC7\x45\xFC\x2E\x0A\x00\x00\xC7\x45\xF8\x79\x2E\x2E\x2E\xC7\x45\xF4\x57\x6F\x6F\x64\xC7\x45\xF0\x2E\x2E\x2E\x2E\xB8\x04\x00\x00\x00\xBB\x01\x00\x00\x00\x8D\x4D\xF0\xBA\x0E\x00\x00\x00\xCD\x80\xC9\xC3\x66\x0F\x70\xD2\xFF\xC5\xC1\x73\xF9\x04\x66\x0F\xEF\xCF\xC5\xC1\x73\xF9\x04\x66\x0F\xEF\xCF\xC5\xC1\x73\xF9\x04\x66\x0F\xEF\xCF\x66\x0F\xEF\xCA\xC3\x8B\x7D\xF0\x8B\x75\xF4\x55\x89\xE5\x83\xEC\x10\xC7\x45\xFC\xEF\xBE\xAD\xDE\xC7\x45\xF8\xEF\xBE\xAD\xDE\xC7\x45\xF4\xEF\xBE\xAD\xDE\xC7\x45\xF0\xEF\xBE\xAD\xDE\x0F\x10\x4D\xF0\x0F\x28\xC1\x66\x0F\x3A\xDF\xD1\x01\xE8\xA1\xFF\xFF\xFF\x0F\x28\xD9\x66\x0F\x3A\xDF\xD1\x02\xE8\x93\xFF\xFF\xFF\x0F\x28\xE1\x66\x0F\x3A\xDF\xD1\x04\xE8\x85\xFF\xFF\xFF\x0F\x28\xE9\x66\x0F\x3A\xDF\xD1\x08\xE8\x77\xFF\xFF\xFF\x0F\x28\xF1\x66\x0F\x3A\xDF\xD1\x10\xE8\x69\xFF\xFF\xFF\x0F\x28\xF9\x66\x0F\x38\xDB\xDB\x66\x0F\x38\xDB\xE4\x66\x0F\x38\xDB\xED\x66\x0F\x38\xDB\xF6\x31\xD2\x39\xD6\x7E\x2A\x0F\x10\x0C\x17\x66\x0F\xEF\xCF\x66\x0F\x38\xDE\xCE\x66\x0F\x38\xDE\xCD\x66\x0F\x38\xDE\xCC\x66\x0F\x38\xDE\xCB\x66\x0F\x38\xDF\xC8\x0F\x11\x0C\x17\x83\xC2\x10\xEB\xD2\xC9\xC3\x55\x89\xE5\x57\x56\x53\x83\xEC\x1C\x8B\x45\x08\x81\x38\x02\x21\x4C\x18\x74\x0C\xC7\x45\xE8\x00\x00\x00\x00\xE9\xC1\x01\x00\x00\xC7\x45\xE8\x00\x00\x00\x00\xC7\x45\xEC\x04\x00\x00\x00\x8B\x45\xEC\x3B\x45\x0C\x0F\x83\xA7\x01\x00\x00\x8B\x45\x08\x8B\x7D\xEC\x8B\x3C\x38\x8B\x45\xEC\x8D\x58\x04\x81\xFF\x90\x80\x80\x00\x77\xC3\x8B\x55\x08\x8B\x45\x14\x01\xDA\x8D\x88\x00\x00\x80\x00\x8D\x34\x3A\x39\xF2\x74\x09\x8A\x02\x42\x41\x88\x41\xFF\xEB\xF3\x8D\x04\x1F\x31\xF6\x31\xD2\x89\x45\xEC\x39\xFE\x0F\x8D\x3D\x01\x00\x00\x8B\x45\x14\x8D\x4E\x01\x0F\xB6\x9C\x30\x00\x00\x80\x00\x89\xCE\x88\x5D\xF0\x83\xFB\x0F\x7E\x72\xC1\xFB\x04\x89\xDE\x83\xFB\x0F\x75\x16\x8B\x45\x14\x41\x0F\xB6\x9C\x08\xFF\xFF\x7F\x00\x01\xDE\x81\xFB\xFF\x00\x00\x00\xEB\xE8\x8D\x41\x01\x89\x75\xE0\x89\x45\xDC\x8D\x42\x01\x89\x45\xD8\x8B\x45\x14\x8A\x9C\x08\x00\x00\x80\x00\x88\x1C\x10\x8B\x45\x14\x01\xC8\x89\x45\xE4\xFF\x45\xE4\xFF\x4D\xE0\x74\x15\x8B\x45\xE4\x29\xC8\x89\xC3\x8B\x45\xE4\x8A\x80\x00\x00\x80\x00\x88\x04\x13\xEB\xE3\x8B\x55\xD8\x4E\x01\xF2\x03\x75\xDC\x39\xF7\x0F\x8E\xB3\x00\x00\x00\x8B\x45\x14\x89\xD3\x0F\xB6\x8C\x30\x00\x00\x80\x00\x8D\x46\x02\x89\x45\xE4\x8B\x45\x14\x29\xCB\x0F\xB6\x8C\x30\x01\x00\x80\x00\x8B\x75\xF0\xC1\xE1\x08\x83\xE6\x0F\x29\xCB\x8A\x4D\xF0\x83\xE1\x0F\x80\xF9\x0F\x75\x20\xBE\x0F\x00\x00\x00\xFF\x45\xE4\x8B\x4D\x14\x8B\x45\xE4\x0F\xB6\x8C\x01\xFF\xFF\x7F\x00\x01\xCE\x81\xF9\xFF\x00\x00\x00\x74\xE5\x8B\x4D\x14\x89\x75\xE0\x01\xD9\x8A\x01\x89\x4D\xF0\x8B\x4D\x14\x88\x04\x11\x8A\x44\x19\x01\x88\x44\x11\x01\x8A\x44\x19\x02\x88\x44\x11\x02\x8D\x42\x04\x89\x45\xDC\x8A\x44\x19\x03\x88\x44\x11\x03\xFF\x4D\xE0\xFF\x45\xF0\x83\x7D\xE0\xFF\x74\x13\x8B\x45\xF0\x29\xD8\x89\xC1\x8B\x45\xF0\x8A\x40\x03\x88\x44\x11\x03\xEB\xE1\x8B\x55\xDC\x01\xF2\x8B\x75\xE4\xE9\xBB\xFE\xFF\xFF\x39\xFE\x0F\x85\x4E\xFE\xFF\xFF\x8B\x7D\xE8\x8B\x75\x14\x03\x7D\x10\x8D\x0C\x17\x39\xCF\x74\x03\xA4\xEB\xF9\x01\x55\xE8\xE9\x4D\xFE\xFF\xFF\x8B\x45\xE8\x83\xC4\x1C\x5B\x5E\x5F\x5D\xC3"
#define PAYLOAD_SIZE_ELF32 961

#define ORIG_SIZE_OFF_ELF32 15
#define COMP_SIZE_OFF_ELF32 22
#define ENC_SIZE_OFF_ELF32 29
#define ALIGN_OFF_ELF32 52
#define KEY_PART1_OFF_ELF32 318
#define KEY_PART2_OFF_ELF32 311
#define KEY_PART3_OFF_ELF32 304
#define KEY_PART4_OFF_ELF32 297
#define LOAD_ADDR_OFF_ELF32 185

#define LOAD_ELF32 "\x8B\x7D\xF0\x8B\x5D\xEC\x8B\x4D\xFC\xBE\x00\x00\x00\x00\x0F\xB6\x04\x33\x88\x04\x37\x83\xC6\x01\x39\xCE\x75\xF2\xB8\x5B\x00\x00\x00\xCD\x80\x83\xC4\x14\x5D\x5B\x59\x5A\x5E\x5F\x58\xE9\xEB\xBE\xAD\xDE"
#define LOAD_SIZE_ELF32 50
#define JMP_ADDR_OFF_ELF32 46

t_data_wrap *pack_elf32(const t_exec_map *exec, const t_data_wrap *key);
t_cave_info	*find_cave_elf32(const void *bin);
void		assemble_woody_elf32(t_data_wrap *woody, t_cave_info *cave_info,
								 const t_data_wrap *key);

#endif //PACK_ELF32_H
