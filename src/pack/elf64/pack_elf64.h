//
// Created by youpaw on 21/08/2021.
//

#ifndef PACK_ELF64_H
#define PACK_ELF64_H

#include "pack_exec.h"
#include <unistd.h>

#define PAYLOAD_ELF64 "\x50\x57\x56\x52\x51\xE8\x0F\x00\x00\x00\xE8\x6F\x00\x00\x00\x59\x5A\x5E\x5F\x58\xE9\xEB\xBE\xAD\xDE\x55\x48\x89\xE5\x48\x83\xEC\x10\xC7\x44\x24\xFC\x2E\x0A\x00\x00\xC7\x44\x24\xF8\x79\x2E\x2E\x2E\xC7\x44\x24\xF4\x57\x6F\x6F\x64\xC7\x44\x24\xF0\x2E\x2E\x2E\x2E\xB8\x01\x00\x00\x00\xBF\x01\x00\x00\x00\x48\x8D\x74\x24\xF0\xBA\x0E\x00\x00\x00\x0F\x05\xC9\xC3\x66\x0F\x70\xD2\xFF\xC5\xE1\x73\xF9\x04\x66\x0F\xEF\xCB\xC5\xE1\x73\xF9\x04\x66\x0F\xEF\xCB\xC5\xE1\x73\xF9\x04\x66\x0F\xEF\xCB\x66\x0F\xEF\xCA\xC3\x49\xBA\xEF\xBE\xAD\xDE\xEF\xBE\xAD\xDE\x49\xB9\xEF\xBE\xAD\xDE\xEF\xBE\xAD\xDE\x49\xB8\xEF\xBE\xAD\xDE\xEF\xBE\xAD\xDE\x66\x49\x0F\x6E\xC9\x66\x49\x0F\x6E\xD0\x0F\x16\xCA\x48\x8D\x3D\x50\xFF\xFF\xFF\x4D\x89\xD3\x49\xF7\xDB\x4C\x01\xDF\x49\x89\xF9\x49\x89\xFB\x48\x81\xE7\x00\x00\x00\xF0\x48\xF7\xDF\x49\x01\xFB\x48\xF7\xDF\x4D\x01\xD3\xB8\x0A\x00\x00\x00\x4C\x89\xDE\xBA\x07\x00\x00\x00\x0F\x05\x4C\x89\xCE\x4C\x89\xD2\xF3\x0F\x6F\xC1\x66\x0F\x3A\xDF\xD1\x01\xE8\x63\xFF\xFF\xFF\xF3\x0F\x6F\xE1\x66\x0F\x3A\xDF\xD1\x02\xE8\x54\xFF\xFF\xFF\xF3\x0F\x6F\xE9\x66\x0F\x3A\xDF\xD1\x04\xE8\x45\xFF\xFF\xFF\xF3\x0F\x6F\xF1\x66\x0F\x3A\xDF\xD1\x08\xE8\x36\xFF\xFF\xFF\xF3\x0F\x6F\xF9\x66\x0F\x3A\xDF\xD1\x10\xE8\x27\xFF\xFF\xFF\xF3\x44\x0F\x6F\xC1\x66\x0F\x3A\xDF\xD1\x20\xE8\x17\xFF\xFF\xFF\xF3\x44\x0F\x6F\xC9\x66\x0F\x3A\xDF\xD1\x40\xE8\x07\xFF\xFF\xFF\xF3\x44\x0F\x6F\xD1\x66\x0F\x3A\xDF\xD1\x80\xE8\xF7\xFE\xFF\xFF\xF3\x44\x0F\x6F\xD9\x66\x0F\x3A\xDF\xD1\x1B\xE8\xE7\xFE\xFF\xFF\xF3\x44\x0F\x6F\xE1\x66\x0F\x3A\xDF\xD1\x36\xE8\xD7\xFE\xFF\xFF\xF3\x44\x0F\x6F\xE9\x66\x0F\x38\xDB\xE4\x66\x0F\x38\xDB\xED\x66\x0F\x38\xDB\xF6\x66\x0F\x38\xDB\xFF\x66\x45\x0F\x38\xDB\xC0\x66\x45\x0F\x38\xDB\xC9\x66\x45\x0F\x38\xDB\xD2\x66\x45\x0F\x38\xDB\xDB\x66\x45\x0F\x38\xDB\xE4\x48\x31\xFF\x48\x39\xFA\x7E\x53\xF3\x44\x0F\x6F\x3C\x3E\x66\x45\x0F\xEF\xFD\x66\x45\x0F\x38\xDE\xFC\x66\x45\x0F\x38\xDE\xFB\x66\x45\x0F\x38\xDE\xFA\x66\x45\x0F\x38\xDE\xF9\x66\x45\x0F\x38\xDE\xF8\x66\x44\x0F\x38\xDE\xFF\x66\x44\x0F\x38\xDE\xFE\x66\x44\x0F\x38\xDE\xFD\x66\x44\x0F\x38\xDE\xFC\x66\x44\x0F\x38\xDF\xF8\xF3\x44\x0F\x7F\x3C\x3E\x48\x83\xC7\x10\xEB\xA8\x4D\x31\xE4\xC3"
#define PAYLOAD_SIZE_ELF64 536

#define SEG_LENGTH_OFF_ELF64 128
#define KEY_PART1_OFF_ELF64 138
#define KEY_PART2_OFF_ELF64 148
#define JMP_ADDR_OFF_ELF64 21
#define ALIGN_OFF_ELF64 194

t_data_wrap *pack_elf64(const t_exec_map *exec, const t_data_wrap *key);
t_cave_info	*find_cave_elf64(const void *bin);
void		assemble_woody_elf64(t_data_wrap *woody, t_cave_info *cave_info,
								 const t_data_wrap *key);

#endif //PACK_ELF64_H
