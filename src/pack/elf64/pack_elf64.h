//
// Created by youpaw on 21/08/2021.
//

#ifndef PACK_ELF64_H
#define PACK_ELF64_H

#include "pack_exec.h"
#include <unistd.h>

#define PAYLOAD_ELF64 "\x50\x57\x56\x52\x51\x41\x54\x41\x55\x41\x56\x41\x57\xE8\xA3\x00\x00\x00\x49\xBD\xEF\xBE\xAD\xDE\xEF\xBE\xAD\xDE\x49\xBE\xEF\xBE\xAD\xDE\xEF\xBE\xAD\xDE\x49\xBF\xEF\xBE\xAD\xDE\xEF\xBE\xAD\xDE\x48\x8D\x3D\xC9\xFF\xFF\xFF\x4D\x89\xFB\x49\xF7\xDB\x4C\x01\xDF\x49\x89\xFC\x49\x89\xFB\x48\x81\xE7\x00\x00\x00\xF0\x48\xF7\xDF\x49\x01\xFB\x48\xF7\xDF\x4D\x01\xEB\xB8\x0A\x00\x00\x00\x4C\x89\xDE\xBA\x07\x00\x00\x00\x0F\x05\x4C\x89\xE7\x4C\x89\xFE\xE8\xA2\x00\x00\x00\x41\xB9\x00\x00\x00\x00\x49\xC7\xC0\xFF\xFF\xFF\xFF\x41\xBA\x22\x00\x00\x00\xBA\x03\x00\x00\x00\x4C\x89\xEE\xBF\x00\x00\x00\x00\xB8\x09\x00\x00\x00\x0F\x05\x50\x41\x55\x41\x54\x4C\x89\xE7\x4C\x89\xF6\x48\x89\xC2\x4C\x89\xE9\xE8\xB4\x01\x00\x00\xE9\xA7\x04\x00\x00\x55\x48\x89\xE5\x48\x83\xEC\x10\xC7\x45\xFC\x2E\x0A\x00\x00\xC7\x45\xF8\x79\x2E\x2E\x2E\xC7\x45\xF4\x57\x6F\x6F\x64\xC7\x45\xF0\x2E\x2E\x2E\x2E\xB8\x01\x00\x00\x00\xBF\x01\x00\x00\x00\x48\x8D\x75\xF0\xBA\x0E\x00\x00\x00\x0F\x05\xC9\xC3\x66\x0F\x70\xD2\xFF\xC5\xE1\x73\xF9\x04\x66\x0F\xEF\xCB\xC5\xE1\x73\xF9\x04\x66\x0F\xEF\xCB\xC5\xE1\x73\xF9\x04\x66\x0F\xEF\xCB\x66\x0F\xEF\xCA\xC3\x49\xB9\xEF\xBE\xAD\xDE\xEF\xBE\xAD\xDE\x49\xB8\xEF\xBE\xAD\xDE\xEF\xBE\xAD\xDE\x66\x49\x0F\x6E\xC9\x66\x49\x0F\x6E\xD0\x0F\x16\xCA\xF3\x0F\x6F\xC1\x66\x0F\x3A\xDF\xD1\x01\xE8\xAB\xFF\xFF\xFF\xF3\x0F\x6F\xE1\x66\x0F\x3A\xDF\xD1\x02\xE8\x9C\xFF\xFF\xFF\xF3\x0F\x6F\xE9\x66\x0F\x3A\xDF\xD1\x04\xE8\x8D\xFF\xFF\xFF\xF3\x0F\x6F\xF1\x66\x0F\x3A\xDF\xD1\x08\xE8\x7E\xFF\xFF\xFF\xF3\x0F\x6F\xF9\x66\x0F\x3A\xDF\xD1\x10\xE8\x6F\xFF\xFF\xFF\xF3\x44\x0F\x6F\xC1\x66\x0F\x3A\xDF\xD1\x20\xE8\x5F\xFF\xFF\xFF\xF3\x44\x0F\x6F\xC9\x66\x0F\x3A\xDF\xD1\x40\xE8\x4F\xFF\xFF\xFF\xF3\x44\x0F\x6F\xD1\x66\x0F\x3A\xDF\xD1\x80\xE8\x3F\xFF\xFF\xFF\xF3\x44\x0F\x6F\xD9\x66\x0F\x3A\xDF\xD1\x1B\xE8\x2F\xFF\xFF\xFF\xF3\x44\x0F\x6F\xE1\x66\x0F\x3A\xDF\xD1\x36\xE8\x1F\xFF\xFF\xFF\xF3\x44\x0F\x6F\xE9\x66\x0F\x38\xDB\xE4\x66\x0F\x38\xDB\xED\x66\x0F\x38\xDB\xF6\x66\x0F\x38\xDB\xFF\x66\x45\x0F\x38\xDB\xC0\x66\x45\x0F\x38\xDB\xC9\x66\x45\x0F\x38\xDB\xD2\x66\x45\x0F\x38\xDB\xDB\x66\x45\x0F\x38\xDB\xE4\x48\x31\xD2\x48\x39\xD6\x7E\x53\xF3\x44\x0F\x6F\x3C\x17\x66\x45\x0F\xEF\xFD\x66\x45\x0F\x38\xDE\xFC\x66\x45\x0F\x38\xDE\xFB\x66\x45\x0F\x38\xDE\xFA\x66\x45\x0F\x38\xDE\xF9\x66\x45\x0F\x38\xDE\xF8\x66\x44\x0F\x38\xDE\xFF\x66\x44\x0F\x38\xDE\xFE\x66\x44\x0F\x38\xDE\xFD\x66\x44\x0F\x38\xDE\xFC\x66\x44\x0F\x38\xDF\xF8\xF3\x44\x0F\x7F\x3C\x17\x48\x83\xC2\x10\xEB\xA8\xC3\x41\x57\x41\x56\x41\x55\x41\x54\x55\x53\x48\x83\xEC\x28\x48\x89\xFB\x49\x89\xF7\x48\x89\x74\x24\x10\x48\x89\x54\x24\x18\x41\xB9\x00\x00\x00\x00\x49\xC7\xC0\xFF\xFF\xFF\xFF\x41\xBA\x22\x00\x00\x00\xBA\x03\x00\x00\x00\xBE\x90\x80\x00\x01\xBF\x00\x00\x00\x00\xB8\x09\x00\x00\x00\x0F\x05\x48\x89\xC7\x81\x3B\x02\x21\x4C\x18\x0F\x85\x6E\x02\x00\x00\x49\x83\xFF\x04\x0F\x86\x8D\x02\x00\x00\x48\xC7\x44\x24\x08\x00\x00\x00\x00\x41\xBC\x04\x00\x00\x00\x4C\x8D\x68\x02\x48\x8D\x68\x05\xE9\xF9\x01\x00\x00\x8D\x50\x01\x45\x8D\x51\x01\x4D\x63\xF1\x44\x8D\x80\x00\x00\x80\x00\x4D\x63\xC0\x46\x0F\xB6\x04\x07\x46\x88\x04\x37\x83\xFE\x01\x0F\x84\x5F\x01\x00\x00\x48\x63\xD2\x48\x01\xFA\x4C\x63\xF8\x4F\x8D\x54\x3D\x00\x44\x8D\x46\xFE\x4D\x01\xC2\x89\x44\x24\x04\x49\x89\xD0\x4D\x29\xF8\x0F\xB6\x82\x00\x00\x80\x00\x43\x88\x04\x30\x48\x83\xC2\x01\x4C\x39\xD2\x75\xE6\x8B\x44\x24\x04\x8D\x04\x30\x46\x8D\x0C\x0E\x41\x39\xC3\x0F\x8E\x4D\x01\x00\x00\x8D\x90\x00\x00\x80\x00\x48\x63\xD2\x0F\xB6\x34\x17\x44\x89\xCA\x29\xF2\x44\x8D\x50\x02\x8D\xB0\x01\x00\x80\x00\x48\x63\xF6\x0F\xB6\x34\x37\xC1\xE6\x08\x29\xF2\x83\xE1\x0F\x83\xF9\x0F\x0F\x84\xEE\x00\x00\x00\x48\x63\xF2\x4D\x63\xF1\x0F\xB6\x04\x37\x42\x88\x04\x37\x8D\x42\x01\x48\x98\x44\x0F\xB6\x04\x07\x41\x8D\x41\x01\x48\x98\x44\x88\x04\x07\x8D\x42\x02\x48\x98\x44\x0F\xB6\x04\x07\x41\x8D\x41\x02\x48\x98\x44\x88\x04\x07\x8D\x42\x04\x45\x8D\x41\x04\x83\xC2\x03\x48\x63\xD2\x44\x0F\xB6\x3C\x17\x41\x8D\x51\x03\x48\x63\xD2\x44\x88\x3C\x17\x44\x8D\x79\xFF\x85\xC9\x0F\x84\xB2\x00\x00\x00\x48\x98\x48\x01\xF8\x4C\x8D\x44\x35\x00\x8D\x51\xFF\x49\x01\xD0\x0F\xB6\x08\x48\x89\xC2\x48\x29\xF2\x42\x88\x0C\x32\x48\x83\xC0\x01\x4C\x39\xC0\x75\xEA\x47\x8D\x4C\x0F\x05\x45\x39\xDA\x0F\x8D\x89\x00\x00\x00\x41\x8D\x42\x01\x41\x8D\x92\x00\x00\x80\x00\x48\x63\xD2\x0F\xB6\x0C\x17\x0F\xB6\xF1\x83\xFE\x0F\x0F\x8E\x1B\xFF\xFF\xFF\xC1\xFE\x04\x83\xFE\x0F\x0F\x85\xA2\xFE\xFF\xFF\x41\x8D\x52\x02\x48\x63\xD2\x89\xD0\x44\x0F\xB6\x84\x17\xFF\xFF\x7F\x00\x44\x01\xC6\x48\x83\xC2\x01\x41\x81\xF8\xFF\x00\x00\x00\x74\xE5\xE9\x7B\xFE\xFF\xFF\x89\xD0\x45\x89\xD1\xE9\xD5\xFE\xFF\xFF\x83\xC0\x03\x48\x98\x41\x89\xC2\x0F\xB6\xB4\x07\xFF\xFF\x7F\x00\x01\xF1\x48\x83\xC0\x01\x81\xFE\xFF\x00\x00\x00\x74\xE7\xE9\xEF\xFE\xFF\xFF\x45\x89\xC1\xE9\x71\xFF\xFF\xFF\x41\x89\xC2\x45\x39\xDA\x0F\x85\x82\x00\x00\x00\x4D\x63\xC9\x48\x8B\x4C\x24\x18\x48\x03\x4C\x24\x08\x4D\x85\xC9\x74\x6B\xB8\x00\x00\x00\x00\x0F\xB6\x14\x07\x88\x14\x01\x48\x83\xC0\x01\x49\x39\xC1\x75\xF0\x48\x01\x44\x24\x08\x4C\x3B\x64\x24\x10\x73\x64\x46\x8B\x1C\x23\x49\x83\xC4\x04\x41\x81\xFB\x90\x80\x80\x00\x77\x3E\x49\x63\xC3\x4A\x8D\x34\x23\x48\x85\xC0\x74\xD7\xBA\x00\x00\x00\x00\x0F\xB6\x0C\x16\x88\x8C\x17\x00\x00\x80\x00\x48\x83\xC2\x01\x48\x39\xD0\x75\xEC\x49\x01\xD4\x41\xBA\x00\x00\x00\x00\x41\xB9\x00\x00\x00\x00\xE9\xF1\xFE\xFF\xFF\x4C\x89\xC8\xEB\xA5\xBE\x90\x80\x00\x01\xB8\x0B\x00\x00\x00\x0F\x05\x48\xC7\x44\x24\x08\x00\x00\x00\x00\x48\x8B\x44\x24\x08\x48\x83\xC4\x28\x5B\x5D\x41\x5C\x41\x5D\x41\x5E\x41\x5F\xC3\x48\xC7\x44\x24\x08\x00\x00\x00\x00\xEB\xE1"
#define PAYLOAD_SIZE_ELF64 1372

#define ORIG_SIZE_OFF_ELF64 20
#define COMP_SIZE_OFF_ELF64 30
#define ENC_SIZE_OFF_ELF64 40
#define ALIGN_OFF_ELF64 73
#define KEY_PART1_OFF_ELF64 279
#define KEY_PART2_OFF_ELF64 289
#define LOAD_ADDR_OFF_ELF64 177


#define LOAD_ELF64 "\x5A\x5E\x5F\xB9\x00\x00\x00\x00\x44\x0F\xB6\x04\x0F\x44\x88\x04\x0A\x48\x83\xC1\x01\x48\x39\xF1\x75\xEE\xB8\x0B\x00\x00\x00\x0F\x05\x41\x5F\x41\x5E\x41\x5D\x41\x5C\x59\x5A\x5E\x5F\x58\xE9\xEB\xBE\xAD\xDE"
#define LOAD_SIZE_ELF64 51
#define JMP_ADDR_OFF_ELF64 47

t_data_wrap *pack_elf64(const t_exec_map *exec, const t_data_wrap *key);
t_cave_info	*find_cave_elf64(const void *bin);
void		assemble_woody_elf64(t_data_wrap *woody, t_cave_info *cave_info,
								 const t_data_wrap *key);

#endif //PACK_ELF64_H
